# Dataset example using the Fireworks backend

This example computes several interaction energies using the Dataset Collection
using the Fireworks distributed queue manager.

## Setup and Configure

Above the base QCFractal installation, this example requires the following
dependencies:
 - Psi4 (`conda install psi4 -c psi4`)
 - fireworks (`pip install fireworks`)

It is recommend to create a development environment from either the
[fireworks.yaml or openff.yaml conda envs](../../devtools/conda-envs).

## Example

### Step 1

It is recommended to run the MongoDB and QCFractal server in separate windows
so that you can see the logging information of interactions with the server.
In production, these are run in the background and their log files can be
directed to a directory.

```bash
# Make MongoDB Directory and start server
# You can skip the mkdir command if you already have a folder somewhere
MONGOPATH=/tmp/fractalex
mkdir -p $MONGOPATH
mongod --dbpath $MONGOPATH
```

The QCFractal server can be started with a `fireworks queue-manager` in the
database `qca_fw_testing`. This will automatically create a fireworks queue
with the name `qca_fw_testing_fireworks_queue`.

```bash
qcfractal-server qca_fw_testing --fireworks-manager
```

### Step 2

A new Database Collection can be added to the server with several systems to be computed.
Add a new Database of several intermolecular reactions. 

This step and following ones should be run in the same window and/or 
as foreground processes separate from the MongoDB and Fireworks servers.

```bash
python build_database.py
```

### Step 3
Add new computation to the queue:
```bash
python compute_database.py
```

### Step 4
Jobs can be executed through canonical Fireworks commands. As we are running
locally it is recommend to use the "rapidfire" command. Fireworks can also
interact with a number of Supercomputer and cluster queue managers such as
Slurm and PBS.
```bash
rlaunch -l fw_lpad.yaml rapidfire
```

Note that the `fw_lpad.yaml` has been set to the same MongoDB as the fractal server
and the name has been set to the autogenerated name as described above.

### Step 5
Query data:
```bash
python query_database.py
``` 


### Cleanup
You can now stop the Fireworks and MongoDB processes

If you wish to remove data from the server you can run the script
```bash
python reset_server.py
```

*Warning!* This can be a very dangerous operation as it will remove all stored
data.  This operation should likely not be used in production and provides
testing functionality only.
